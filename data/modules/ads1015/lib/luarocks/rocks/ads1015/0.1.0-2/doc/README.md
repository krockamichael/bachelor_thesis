<img align="right" src="ads1015.jpg" width="150">

# ADS1015 Lua driver

A [lua-periphery](https://github.com/vsergeev/lua-periphery) based sensor driver for the ADS1015 4-channel analog-to-digital converter (ADC) with 12-bit precision and programmable gain amplifier (PGA).

## Installing

If you are on Linux:

```sh
$ luarocks install ads1015
```

Otherwise, you can use the Lua module from within a Go app via [glua-periphery](https://github.com/BixData/gluaperiphery).

## Using

### Taking a single reading

The following script takes a single-ended (non-differential) reading from channel 0 which has been tied to 3.3V.

```lua
local ads1015 = require 'ads1015'
local periphery = require 'periphery'

local i2c = periphery.I2C('/dev/i2c-1')
local device, channel, gain, dataRate = 0x48, 0, 1, nil
local value = ads1015.readSingleValue(i2c, device, channel, gain, dataRate)
print(string.format('raw value  = %d', value))
print(string.format('as voltage = %f V', ads1015.toVoltage(value, gain)))
```

Sample output:

```
raw value  = 1641
as voltage = 3.283603 V
```

### Taking continuous readings

The following script takes continuous readings on a Raspberry Pi 3 B+. The ADS1015 is configured to take samples continuously at 1,600 samples/sec, while the loop itself indicates how fast it can keep up, wich is around 1,100 samples/sec.

```lua
local ads1015 = require 'ads1015'
local periphery = require 'periphery'
local socket = require 'socket'

local i2c = periphery.I2C('/dev/i2c-1')
local dataRate = 1600
local value = ads1015.startContinuous(i2c, device, channel, gain, dataRate)
local values = {value}
local startTime = socket.gettime()
local count = 0
while true do
  value = ads1015.readContinuousValue(i2c, device)
  count = count + 1
  values[#values+1] = string.format('%5.4f', ads1015.toVoltage(value, gain))
  if #values >= 16 then
    print(table.concat(values, ' '))
    values = {}
  end
  local elapsed = socket.gettime() - startTime
  if elapsed >= 1 then
    print(string.format('%d samples/sec', count))
    startTime = socket.gettime()
    count = 0
  end
end
ads1015.stopContinuous(i2c, device)
```

A [Loop Simulator Pro](https://www.theautomationstore.com/analog-simulator-and-generator-with-lcd-0-10vdc-and-4-20ma/?gclid=EAIaIQobChMIt9_JtN374gIVl_hkCh0d7Qk9EAQYASABEgJGE_D_BwE) is used to drive the input using a sweep cycle between 0V and 4V.

![Loop Simulator Pro](loopsimpro.png)

One second worth of output:

```
2.4852 2.4872 2.4852 2.4832 2.4792 2.4872 2.4852 2.4812 2.4872 2.4812 2.4852 2.4852 2.4872 2.4872 2.4852 2.4872
2.4832 2.4832 2.4872 2.4832 2.4812 2.4832 2.4912 2.4852 2.4872 2.4852 2.4852 2.4852 2.4792 2.4852 2.4832 2.4852
2.4892 2.4832 2.4832 2.4832 2.4832 2.4872 2.4832 2.4812 2.4832 2.4832 2.4492 2.3872 2.3872 2.3852 2.3832 2.3852
2.3892 2.3872 2.3852 2.3872 2.3852 2.3832 2.3872 2.3832 2.3892 2.3872 2.3832 2.3852 2.3832 2.3852 2.3832 2.3832
2.3832 2.3832 2.3832 2.3852 2.3852 2.3792 2.3852 2.3852 2.3852 2.3832 2.3812 2.3832 2.3852 2.3832 2.3852 2.3852
2.3832 2.3852 2.3872 2.3812 2.3792 2.3832 2.3832 2.3872 2.3792 2.3852 2.3872 2.3792 2.3832 2.3872 2.3872 2.3872
2.3872 2.3872 2.3852 2.3832 2.3892 2.3892 2.3832 2.3812 2.3872 2.3852 2.3832 2.3872 2.3852 2.3892 2.3872 2.3852
2.3892 2.3912 2.3852 2.3912 2.3832 2.3872 2.3872 2.3832 2.3852 2.3832 2.3872 2.3832 2.3832 2.3852 2.3832 2.3792
2.3812 2.3812 2.3792 2.3872 2.3832 2.3832 2.3812 2.3852 2.3832 2.3852 2.3892 2.3852 2.3832 2.3832 2.3812 2.3832
2.3832 2.3852 2.3832 2.3832 2.3852 2.3832 2.3832 2.3852 2.3832 2.3852 2.3872 2.3812 2.3872 2.3852 2.3912 2.3812
2.3832 2.3852 2.3812 2.3812 2.3832 2.3812 2.3812 2.3832 2.3832 2.3852 2.3852 2.3852 2.3872 2.3792 2.3872 2.3872
2.3812 2.3832 2.3852 2.3872 2.3872 2.3852 2.3872 2.3832 2.3852 2.3832 2.3872 2.3852 2.3852 2.3812 2.3872 2.3832
2.3832 2.3191 2.2831 2.2831 2.2791 2.2851 2.2791 2.2791 2.2851 2.2851 2.2851 2.2831 2.2831 2.2831 2.2791 2.2811
2.2851 2.2851 2.2811 2.2851 2.2831 2.2811 2.2791 2.2811 2.2831 2.2791 2.2831 2.2831 2.2851 2.2831 2.2811 2.2851
2.2831 2.2811 2.2831 2.2851 2.2791 2.2831 2.2791 2.2771 2.2771 2.2811 2.2811 2.2811 2.2811 2.2791 2.2811 2.2811
2.2811 2.2831 2.2811 2.2831 2.2791 2.2811 2.2831 2.2791 2.2851 2.2831 2.2891 2.2831 2.2811 2.2871 2.2831 2.2811
2.2811 2.2831 2.2811 2.2851 2.2791 2.2791 2.2811 2.2811 2.2811 2.2851 2.2851 2.2871 2.2811 2.2811 2.2851 2.2771
2.2831 2.2851 2.2851 2.2831 2.2831 2.2851 2.2811 2.2811 2.2831 2.2871 2.2871 2.2831 2.2851 2.2811 2.2851 2.2851
2.2831 2.2831 2.2831 2.2811 2.2811 2.2811 2.2811 2.2851 2.2851 2.2851 2.2851 2.2831 2.2811 2.2871 2.2851 2.2851
2.2871 2.2851 2.2811 2.2851 2.2831 2.2811 2.2811 2.2831 2.2811 2.2791 2.2771 2.2851 2.2831 2.2831 2.2851 2.2851
2.2851 2.2831 2.2851 2.2851 2.2811 2.2831 2.2851 2.2811 2.2851 2.2811 2.2851 2.2831 2.2791 2.2831 2.2851 2.2811
2.2831 2.2851 2.2871 2.2831 2.2851 2.2851 2.2611 2.1831 2.1811 2.1831 2.1851 2.1831 2.1831 2.1851 2.1811 2.1811
2.1771 2.1811 2.1831 2.1831 2.1831 2.1891 2.1831 2.1811 2.1791 2.1831 2.1811 2.1811 2.1791 2.1791 2.1811 2.1791
2.1811 2.1791 2.1751 2.1831 2.1751 2.1791 2.1831 2.1771 2.1791 2.1851 2.1831 2.1871 2.1831 2.1831 2.1791 2.1811
2.1851 2.1831 2.1831 2.1811 2.1851 2.1851 2.1791 2.1811 2.1891 2.1851 2.1871 2.1811 2.1851 2.1831 2.1811 2.1851
2.1871 2.1811 2.1871 2.1831 2.1831 2.1851 2.1811 2.1811 2.1831 2.1851 2.1831 2.1891 2.1851 2.1851 2.1871 2.1871
2.1851 2.1811 2.1831 2.1811 2.1851 2.1811 2.1791 2.1811 2.1791 2.1851 2.1871 2.1831 2.1891 2.1831 2.1871 2.1851
2.1791 2.1851 2.1811 2.1851 2.1871 2.1891 2.1891 2.1851 2.1871 2.1851 2.1851 2.1851 2.1851 2.1831 2.1811 2.1871
2.1891 2.1831 2.1831 2.1831 2.1831 2.1851 2.1811 2.1811 2.1811 2.1811 2.1831 2.1851 2.1831 2.1871 2.1831 2.1791
2.1811 2.1831 2.1831 2.1831 2.1771 2.1811 2.1831 2.1831 2.1851 2.1871 2.1771 2.1791 2.1811 2.1811 2.1851 2.1831
2.1811 2.1811 2.1811 2.1811 2.1811 2.1851 2.1811 2.1851 2.1851 2.1831 2.1871 2.1871 2.0830 2.0870 2.0810 2.0830
2.0830 2.0790 2.0810 2.0870 2.0810 2.0810 2.0850 2.0830 2.0890 2.0870 2.0830 2.0850 2.0870 2.0850 2.0830 2.0850
2.0870 2.0810 2.0790 2.0810 2.0790 2.0810 2.0810 2.0850 2.0850 2.0850 2.0810 2.0830 2.0790 2.0810 2.0810 2.0850
2.0830 2.0830 2.0790 2.0830 2.0810 2.0870 2.0830 2.0850 2.0850 2.0830 2.0850 2.0890 2.0830 2.0830 2.0870 2.0850
2.0870 2.0830 2.0790 2.0830 2.0810 2.0830 2.0830 2.0850 2.0810 2.0810 2.0830 2.0810 2.0850 2.0830 2.0850 2.0830
2.0870 2.0850 2.0850 2.0790 2.0810 2.0810 2.0830 2.0830 2.0830 2.0790 2.0810 2.0830 2.0830 2.0850 2.0830 2.0810
2.0830 2.0830 2.0850 2.0830 2.0850 2.0810 2.0870 2.0870 2.0790 2.0830 2.0870 2.0810 2.0770 2.0850 2.0890 2.0830
2.0830 2.0850 2.0870 2.0830 2.0850 2.0850 2.0830 2.0810 2.0830 2.0790 2.0850 2.0810 2.0850 2.0830 2.0850 2.0850
2.0870 2.0830 2.0770 2.0750 2.0770 2.0790 2.0790 2.0830 2.0790 2.0790 2.0830 2.0790 2.0850 2.0790 2.0830 2.0850
2.0810 2.0850 2.0770 2.0850 2.0830 2.0810 2.0810 2.0770 2.0850 2.0850 2.0810 2.0870 2.0850 2.0790 2.0890 2.0890
2.0790 2.0750 1.9910 1.9930 1.9890 1.9870 1.9850 1.9910 1.9850 1.9910 1.9890 1.9910 1.9850 1.9910 1.9930 1.9910
1.9850 1.9910 1.9870 1.9870 1.9910 1.9870 1.9910 1.9870 1.9890 1.9910 1.9910 1.9910 1.9930 1.9910 1.9850 1.9890
1.9910 1.9910 1.9870 1.9890 1.9910 1.9870 1.9930 1.9890 1.9910 1.9930 1.9870 1.9890 1.9930 1.9910 1.9910 1.9850
1.9870 1.9870 1.9910 1.9910 1.9890 1.9870 1.9890 1.9810 1.9870 1.9830 1.9850 1.9850 1.9870 1.9910 1.9890 1.9850
1.9910 1.9910 1.9870 1.9870 1.9910 1.9930 1.9870 1.9890 1.9850 1.9830 1.9830 1.9850 1.9870 1.9890 1.9890 1.9910
1.9930 1.9850 1.9850 1.9930 1.9910 1.9870 1.9870 1.9910 1.9870 1.9890 1.9890 1.9890 1.9910 1.9930 1.9870 1.9910
1.9850 1.9890 1.9830 1.9850 1.9870 1.9850 1.9850 1.9870 1.9910 1.9870 1.9890 1.9870 1.9870 1.9890 1.9850 1.9890
1.9870 1.9870 1.9910 1.9890 1.9910 1.9870 1.9890 1.9850 1.9910 1.9890 1.9870 1.9850 1.9830 1.9870 1.9830 1.9870
1.9870 1.9870 1.9870 1.9890 1.9870 1.9890 1.9850 1.9870 1.9890 1.9890 1.9890 1.9850 1.9910 1.9910 1.9890 1.9870
1.9870 1.9810 1.9810 1.9850 1.9850 1.9850 1.9910 1.9670 1.8909 1.8929 1.8869 1.8909 1.8909 1.8889 1.8849 1.8869
1.8869 1.8889 1.8889 1.8909 1.8849 1.8849 1.8909 1.8889 1.8829 1.8829 1.8869 1.8869 1.8829 1.8889 1.8869 1.8869
1.8869 1.8869 1.8869 1.8849 1.8869 1.8849 1.8849 1.8829 1.8869 1.8909 1.8889 1.8849 1.8889 1.8849 1.8869 1.8869
1.8849 1.8889 1.8909 1.8869 1.8909 1.8869 1.8909 1.8889 1.8889 1.8849 1.8849 1.8869 1.8869 1.8849 1.8889 1.8889
1.8869 1.8849 1.8889 1.8829 1.8869 1.8869 1.8889 1.8869 1.8909 1.8889 1.8869 1.8869 1.8869 1.8909 1.8869 1.8889
1.8889 1.8889 1.8889 1.8869 1.8929 1.8929 1.8889 1.8909 1.8889 1.8909 1.8889 1.8849 1.8889 1.8929 1.8829 1.8869
1.8889 1.8869 1.8829 1.8869 1.8889 1.8909 1.8869 1.8909 1.8869 1.8889 1.8889 1.8909 1.8849 1.8869 1.8869 1.8909
1.8929 1.8869 1.8889 1.8849 1.8909 1.8889 1.8889 1.8929 1.8889 1.8909 1.8909 1.8889 1.8909 1.8909 1.8869 1.8849
1.8869 1.8909 1.8909 1.8909 1.8889 1.8929 1.8869 1.8889 1.8849 1.8889 1.8869 1.8849 1.8909 1.8929 1.8929 1.8929
1.8909 1.8969 1.8889 1.8889 1.8929 1.8929 1.8949 1.8909 1.8869 1.8909 1.8889 1.8909 1.8929 1.8889 1.7889 1.7949
1.7909 1.7909 1.7889 1.7869 1.7929 1.7849 1.7909 1.7909 1.7909 1.7869 1.7849 1.7869 1.7849 1.7889 1.7909 1.7889
1.7869 1.7929 1.7849 1.7889 1.7869 1.7869 1.7849 1.7889 1.7869 1.7889 1.7889 1.7869 1.7829 1.7889 1.7909 1.7909
1.7929 1.7869 1.7869 1.7869 1.7889 1.7889 1.7889 1.7889 1.7889 1.7949 1.7909 1.7889 1.7869 1.7909 1.7869 1.7849
1.7949 1.7909 1.7909 1.7909 1.7949 1.7929 1.7869 1.7949 1.7929 1.7909 1.7869 1.7909 1.7869 1.7909 1.7869 1.7969
1.7889 1.7889 1.7849 1.7889 1.7869 1.7869 1.7889 1.7909 1.7889 1.7909 1.7969 1.7889 1.7889 1.7869 1.7869 1.7829
1.7889 1.7889 1.7929 1.7869 1.7869 1.7909 1.7869 1.7869 1.7829 1.7909 1.7849 1.7889 1.7869 1.7869 1.7849 1.7889
1.7849 1.7849 1.7869 1.7849 1.7889 1.7829 1.7849 1.7909 1.7929 1.7889 1.7869 1.7909 1.7849 1.7889 1.7849 1.7889
1.7849 1.7829 1.7889 1.7889 1.7889 1.7869 1.7849 1.7889 1.7889 1.7929 1.7849 1.7889 1.7929 1.7869 1.7889 1.7849
1.7869 1.7929 1.7909 1.7889 1.7889 1.7869 1.7869 1.7929 1.7869 1.7889 1.7869 1.7949 1.7909 1.7829 1.7909 1.7889
1.7909 1.7869 1.7008 1.6928 1.6888 1.6868 1.6908 1.6888 1.6908 1.6928 1.6908 1.6888 1.6948 1.6908 1.6888 1.6888
1.6948 1.6848 1.6868 1.6908 1.6828 1.6868 1.6868 1.6888 1.6868 1.6908 1.6848 1.6868 1.6908 1.6908 1.6848 1.6868
1.6888 1.6868 1.6868 1.6888 1.6868 1.6848 1.6868 1.6888 1.6908 1.6908 1.6868 1.6888 1.6868 1.6848 1.6888 1.6888
1135 samples/sec
...
```
